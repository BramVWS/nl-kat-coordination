{"version":3,"file":"expando-rows.min.js","sources":["../../src/js/utils.js","../../src/js/expando-rows.js"],"sourcesContent":["/**\n * Run the given callback function once after the DOM is ready.\n *\n * @param {() => void} fn\n */\nexport function onDomReady(fn) {\n\tif (document.readyState !== \"loading\") return fn();\n\tdocument.addEventListener(\"DOMContentLoaded\", fn);\n}\n\n/**\n * Provide the given element with a unique generated `id`, if it does not have one already.\n *\n * @param {HTMLElement} element\n */\nexport function ensureElementHasId(element) {\n\tif (!element.id) {\n\t\telement.id =\n\t\t\telement.tagName + \"-\" + (~~(Math.random() * 1e9) + 1e9).toString(16);\n\t}\n}\n\n/**\n * Set up a matchMedia change event listener. Returns a function that, when\n * called, will remove the event listener again.\n *\n * @param {string} media\n * @param {(event: { matches: boolean }) => void} handler\n * @return {() => void}\n */\nexport function onMediaQueryMatch(media, handler) {\n\tvar mql = window.matchMedia(media);\n\n\tif (mql.addEventListener) {\n\t\tmql.addEventListener(\"change\", handler);\n\t} else {\n\t\tmql.addListener(handler);\n\t}\n\n\thandler(mql);\n\n\treturn function remove() {\n\t\tif (mql.addEventListener) {\n\t\t\tmql.removeEventListener(\"change\", handler);\n\t\t} else {\n\t\t\tmql.removeListener(handler);\n\t\t}\n\t};\n}\n\n/**\n * @param {HTMLElement} parent\n * @param {HTMLElement} child\n */\nexport function prependNode(parent, child) {\n\tvar children = parent.childNodes;\n\tif (children.length) parent.insertBefore(child, children[0]);\n\telse parent.appendChild(child);\n}\n\n/**\n * Set up a MutationObserver. Returns a disconnect function.\n * @param {() => void} handler\n * @param {HTMLElement | undefined} [root]\n * @return {undefined|() => void}\n */\nexport function onDomUpdate(handler, root) {\n\tif (\"MutationObserver\" in window) {\n\t\tvar observer = new MutationObserver(handler);\n\t\tobserver.observe(root || document, { childList: true, subtree: true });\n\t\treturn observer.disconnect.bind(observer);\n\t}\n}\n\n/**\n * Ponyfill for Element.prototype.closest.\n * @param {Element} element\n * @param {DOMString} selectors\n * @return {Element | null}\n */\nexport function closest(element, selectors) {\n\tif (Element.prototype.closest) {\n\t\treturn element.closest(selectors);\n\t}\n\tvar matches =\n\t\tElement.prototype.matches ||\n\t\tElement.prototype.msMatchesSelector ||\n\t\tElement.prototype.webkitMatchesSelector;\n\n\tdo {\n\t\tif (matches.call(element, selectors)) {\n\t\t\treturn element;\n\t\t}\n\t\telement = element.parentElement || element.parentNode;\n\t} while (element !== null && element.nodeType === 1);\n\n\treturn null;\n}\n","// @ts-check\n\nimport {\n\tclosest,\n\tensureElementHasId,\n\tonDomReady,\n\tonDomUpdate,\n} from \"./utils.js\";\n\nvar managedTables = new WeakMap();\n\nonDomReady(initExpandoRows);\nonDomUpdate(initExpandoRows);\n\n/**\n * Add a close/open toggle behaviour to expando-rows. Safe to call again to\n * apply to newly added expando-rows.\n */\nexport function initExpandoRows() {\n\tvar tables = document.querySelectorAll(\"table\");\n\tfor (var i = 0; i < tables.length; i++) {\n\t\tvar table = tables[i];\n\t\tif (!(table instanceof HTMLElement)) {\n\t\t\tcontinue;\n\t\t}\n\t\tif (\n\t\t\t!(table instanceof HTMLElement) ||\n\t\t\t!table.querySelector(\".expando-button\") ||\n\t\t\tmanagedTables.has(table)\n\t\t) {\n\t\t\tcontinue;\n\t\t}\n\t\tinitTable(table);\n\t\tmanagedTables.set(table, true);\n\t}\n\tdocument.body.classList.add(\"js-expando-rows-loaded\");\n}\n\n/**\n * Start managing the table's expando-buttons, their corresponding\n * expando-rows, and the zebra striping of the other rows.\n * @param {HTMLElement} table\n */\nfunction initTable(table) {\n\tinitExpandoButtons(table);\n\tupdateZebra(table);\n\tonDomUpdate(function () {\n\t\tinitExpandoButtons(table);\n\t\tupdateZebra(table);\n\t}, table);\n}\n\n/**\n * Setup the table's expando-buttons to handle clicks and control their\n * corresponding expando-rows. Safe to call again to apply to newly added\n * expando-buttons.\n * @param {HTMLElement} table\n */\nfunction initExpandoButtons(table) {\n\tvar buttons = table.querySelectorAll(\".expando-button\");\n\tfor (var i = 0; i < buttons.length; i++) {\n\t\tvar button = buttons[i];\n\t\tif (\n\t\t\t!(button instanceof HTMLElement) ||\n\t\t\tbutton.hasAttribute(\"aria-controls\") ||\n\t\t\tbutton.hasAttribute(\"disabled\")\n\t\t) {\n\t\t\tcontinue;\n\t\t}\n\t\tinitExpandoButton(button);\n\t}\n}\n\n/**\n * Setup an expando-buttons to handle clicks and control its corresponding\n * expando-row.\n * @param {HTMLElement} button\n */\nfunction initExpandoButton(button) {\n\tvar iconOpenClasses = (\n\t\tbutton.dataset.iconOpenClass || \"icon icon-chevron-light-bottom\"\n\t).split(/\\s+/);\n\tvar iconCloseClasses = (\n\t\tbutton.dataset.iconCloseClass || \"icon icon-chevron-light-top\"\n\t).split(/\\s+/);\n\n\tvar buttonRow = closest(button, \"tr\");\n\tvar row = buttonRow.nextElementSibling;\n\tif (\n\t\t!(row instanceof HTMLElement) ||\n\t\t!(row.tagName === \"TR\") ||\n\t\t!row.classList.contains(\"expando-row\")\n\t) {\n\t\tconsole.warn(\n\t\t\t\"Could not find .expando-row corresponding to .expando-button:\",\n\t\t\tbutton\n\t\t);\n\t\tbutton.setAttribute(\"disabled\", \"\");\n\t\tbutton.classList.add(\"action-button\");\n\t\tbutton.classList.add.apply(\n\t\t\tbutton.classList,\n\t\t\texpanded ? iconCloseClasses : iconOpenClasses\n\t\t);\n\t\treturn;\n\t}\n\n\tvar expanded = button.getAttribute(\"aria-expanded\") === \"true\";\n\tvar closeLabel, openLabel;\n\tif (expanded) {\n\t\tcloseLabel = button.innerText;\n\t\topenLabel = button.dataset.openLabel || \"Open details\";\n\t\tbutton.setAttribute(\"aria-expanded\", \"true\");\n\t} else {\n\t\tcloseLabel = button.dataset.closeLabel || \"Sluit details\";\n\t\topenLabel = button.innerText;\n\t\tbutton.setAttribute(\"aria-expanded\", \"false\");\n\t\trow.setAttribute(\"hidden\", \"\");\n\t}\n\n\tensureElementHasId(row);\n\tbutton.setAttribute(\"aria-controls\", row.id);\n\tbutton.classList.add(\"action-button\");\n\tbutton.classList.add.apply(\n\t\tbutton.classList,\n\t\texpanded ? iconCloseClasses : iconOpenClasses\n\t);\n\n\tbutton.addEventListener(\"click\", function () {\n\t\tvar expand = button.getAttribute(\"aria-expanded\") === \"false\";\n\t\tbutton.setAttribute(\"aria-expanded\", expand ? \"true\" : \"false\");\n\t\tif (expand) {\n\t\t\tbutton.innerHTML = closeLabel;\n\t\t\tbutton.classList.remove.apply(\n\t\t\t\tbutton.classList,\n\t\t\t\texpanded ? iconOpenClasses : iconCloseClasses\n\t\t\t);\n\t\t\tbutton.classList.add.apply(\n\t\t\t\tbutton.classList,\n\t\t\t\texpanded ? iconCloseClasses : iconOpenClasses\n\t\t\t);\n\t\t\trow.removeAttribute(\"hidden\");\n\t\t} else {\n\t\t\tbutton.innerHTML = openLabel;\n\t\t\tbutton.classList.remove.apply(\n\t\t\t\tbutton.classList,\n\t\t\t\texpanded ? iconCloseClasses : iconOpenClasses\n\t\t\t);\n\t\t\tbutton.classList.add.apply(\n\t\t\t\tbutton.classList,\n\t\t\t\texpanded ? iconOpenClasses : iconCloseClasses\n\t\t\t);\n\t\t\trow.setAttribute(\"hidden\", \"\");\n\t\t}\n\t});\n}\n\n/**\n * Update the rows' .odd/.even override classes.\n * @param {HTMLElement} table\n */\nfunction updateZebra(table) {\n\tvar rows = table.querySelectorAll(\"tr:not(.expando-row)\");\n\tfor (var i = 0; i < rows.length; i++) {\n\t\tvar row = rows[i];\n\t\tif (i % 2) {\n\t\t\trow.classList.add(\"odd\");\n\t\t\trow.classList.remove(\"even\");\n\t\t} else {\n\t\t\trow.classList.add(\"even\");\n\t\t\trow.classList.remove(\"odd\");\n\t\t}\n\t}\n}\n"],"names":["onDomUpdate","handler","root","window","observer","MutationObserver","observe","document","childList","subtree","disconnect","bind","managedTables","WeakMap","initExpandoRows","tables","querySelectorAll","i","length","table","HTMLElement","querySelector","has","initTable","set","body","classList","add","initExpandoButtons","updateZebra","buttons","button","hasAttribute","initExpandoButton","iconOpenClasses","dataset","iconOpenClass","split","iconCloseClasses","iconCloseClass","row","element","selectors","Element","prototype","closest","matches","msMatchesSelector","webkitMatchesSelector","call","parentElement","parentNode","nodeType","nextElementSibling","tagName","contains","console","warn","setAttribute","apply","expanded","closeLabel","openLabel","getAttribute","innerText","id","Math","random","toString","addEventListener","expand","innerHTML","remove","removeAttribute","rows","fn","readyState","onDomReady"],"mappings":"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"}